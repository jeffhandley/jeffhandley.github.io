---
layout: post
title: "DomainDataSource, ComboBox, and Load Blocking"
date: 2010-06-22 08:40:02 -0700
comments: true
category: Archive
tags: []
redirect_from: ["http://jeffhandley.com/archive/2010/06/22/DomainDataSource-ComboBox.aspx", "http://jeffhandley.com/archive/2010/06/22/domaindatasource-combobox.aspx"]
author: 0
---
<!-- more -->
<p>Over on <a href="http://forums.silverlight.net/forums/53.aspx" target="_blank">our forums</a>, many of you have reported difficulty with the ComboBox control when using RIA Services.  <a href="http://blogs.msdn.com/kylemc/" target="_blank">Kyle McClellan</a> <a href="http://twitter.com/KyleMcClellan/" target="_blank">(@KyleMcClellan</a>) suggested that we drill into various ComboBox scenarios to see what works well and what doesn’t.  Our goal was to produce some samples that address common scenarios, and to offer general guidance for ComboBox usage.</p>  <p>Here are a few scenarios we looked at: </p>  <ol>   <li>Async loading of ItemsSource with a SelectedItem/SelectedValue binding; </li>    <li>Cascading drop-downs such as selecting <em>Year - Make - Model</em> for a car; </li>    <li>Binding a ComboBox to a list of <em>non-Entity types</em>, such as an IEnumerable&lt;string&gt;. </li> </ol>  <h3>Should I Use DomainDataSource for a ComboBox?</h3>  <p><em>Short answer: No</em></p>  <p>While I rejected the notion at first, as did the DomainDataSource’s PM, <a href="http://blogs.msdn.com/deepm/" target="_blank">Deepesh Mohnani</a> (<a href="http://twitter.com/deepeshm" target="_blank">@DeepeshM</a>), we all came to the conclusion that the DomainDataSource control doesn’t do a very good job integrating with the ComboBox for the above scenarios.  There are a few things getting in the way.</p>  <h5>Async Data Loads</h5>  <p>When you bind the ComboBox’s ItemsSource to a DomainDataSource and then invoke the load, the ComboBox doesn’t handle bindings to the SelectedItem or SelectedValue because the item/value doesn’t yet exist in the list.  The selection is bound synchronously, but the items are loaded in asynchronously.  This mismatch will cause you all sorts of frustration.</p>  <h5>Load Blocking</h5>  <p>The DomainDataSource halts its data loads once there are changes to the DomainContext.  There is some background on this issue in <a href="http://jeffhandley.com/archive/2009/07/14/domaindatasourcesurvey.aspx">this blog post</a>, where I solicited feedback about mixing data loads with pending changes.  We made the decision to block loads once changes exist, to prevent some nasty conflicts from occurring.</p>  <p>The load blocking becomes a problem with ComboBox because you are usually editing or adding an entity—as soon as you’ve started doing this, HasChanges becomes true, and subsequent loads for the DomainDataSource will be blocked.  This problem is exacerbated when dealing with cascading drop-downs where you want to allow the user to drill down to make a selection.</p>  <h5>Non-Entity Types</h5>  <p>DomainDataSource has no support for loading lists scalar types—it’s limited to EntityQuery operations.  So if you have an [Invoke] operation on the server that returns a collection of scalar values, there’s no way to use the DomainDataSource to load and expose this data.</p>  <h3>But It Works For Me</h3>  <p>We’ve seen (and written) many samples where DomainDataSource is used to successfully populate a ComboBox, but it really seems that once you grow beyond the simplest scenarios, it just breaks down.  It’s probably not wise to use a solution that isn’t going to scale with your scenarios.</p>  <h3>What Should I do?</h3>  <p><em>Short answer: Subscribe to Kyle’s Blog</em></p>  <p>Kyle put together a <a href="http://blogs.msdn.com/b/kylemc/archive/2010/06/18/combobox-sample-for-ria-services.aspx" target="_blank">blog post</a> that includes a sample application, a ComboBoxDataSource control, and a ComboBox extension class that drastically simplifies many scenarios.  Go read his post now.</p>  <p><em>As an aside, Kyle is taking over as the primary developer of the DomainDataSource feature for RIA Services.  I have thoroughly enjoyed this feature, and I’ll still be involved, but Kyle is the new dev owner.  Kyle did some heavy lifting in the feature area in V1 too, including the removal of ControlParameter and all of the support for ICommand and other Silverlight 4 niceties.</em></p>  <h3>Will DomainDataSource Support ComboBox in the Future?</h3>  <p><em>Short Answer: You tell us… should it?</em></p>  <p>Kyle and I spent some time talking through what we could do to improve the ComboBox support for DomainDataSource.  There are a couple of ideas we wanted to put out there to get feedback.</p>  <h5>Read-Only Mode for DomainDataSource</h5>  <p>As I alluded to, we found many reasons why the DomainDataSource should not perform data loads when the DomainContext has changes.  But we’re considering offering an IsReadOnly property on the control that would indicate that the data to be loaded is read-only data.  When IsReadOnly is set to <em>true</em>, that would have the following effects on the control’s behavior:</p>  <ol>   <li>Loads would not get blocked when the DomainContext.HasChanges property is true; </li>    <li>The DomainDataSource would not support Add or Remove actions against in read-only mode. </li> </ol>  <p>We think this read-only mode would help in the ComboBox scenarios because you can now have the ComboBox ItemsSource bound to a DomainDataSource that can load data after the user begins adding or editing entities.  Cascading/drill-down selections would be possible because the loads would never be blocked.  <em>We’d still have the async loading problem to deal with though.</em></p>  <h5>DataSource Control for non-Entity types</h5>  <p>The DomainDataSource control is limited to calling EntityQuery load operations.  Much of the functionality of DomainDataSource could be extracted out into another control that could work against any InvokeOperation though.  Imagine having a method on the server that returns an IEnumerable&lt;int&gt; to return the list of years for car selection - there’s no reason to make an Entity out of Year just so that you can put a Query method on it for the DomainDataSource to be able to call it?</p>  <p>In fact, <a href="https://code.msdn.microsoft.com/Release/ProjectReleases.aspx?ProjectName=RiaServices&amp;ReleaseId=4521" target="_blank">Kyle’s sample</a> includes a ComboBoxDataSource control that handles both Query and Invoke operations.  This is a very light-weight solution.  Perhaps it’s enough.</p>  <h5>What Say You?</h5>  <p>Is this an area that we need to invest in?  Would you like to see these scenarios addressed with the DomainDataSource, a separate DataSource, or in some other way?  How do you think ComboBox should behave when ItemsSource is bound to an async collection?  Does Kyle’s sample give you what you need?</p>  <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:5e51745b-6d09-4833-800f-5c73e25849fe" class="wlWriterEditableSmartContent">Technorati Tags: <a href="http://technorati.com/tags/RIAServices" rel="tag">RIAServices</a>,<a href="http://technorati.com/tags/DomainDataSource" rel="tag">DomainDataSource</a>,<a href="http://technorati.com/tags/ComboBox" rel="tag">ComboBox</a>,<a href="http://technorati.com/tags/Silverlight" rel="tag">Silverlight</a></div>

