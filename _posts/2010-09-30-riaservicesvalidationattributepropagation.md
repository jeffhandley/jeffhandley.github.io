---
layout: post
title: "RIA Services Validation: Attribute Propagation"
date: 2010-09-30 09:37:56 -0700
comments: true
category: Archive
tags: []
redirect_from: ["/archive/2010/09/30/RiaServicesValidationAttributePropagation.aspx", "/archive/2010/09/30/riaservicesvalidationattributepropagation.aspx"]
author: 0
---
<!-- more -->
<p>Since the beginning of the RIA Services project, a primary tenet was to propagate validation rules defined on the server up to the client, integrating the validation directly into the Silverlight UI.  This came to fruition with RIA Services v1.0 and you can in fact apply an attribute to your model on the server and automatically get instant client-side validation of data entry on even the simplest of Textbox controls.  In fact, some validation rules are inferred from your data model directly.  This is a feat that many other frameworks have attempted to accomplish, but I believe RIA Services has one of the most successful implementations of the concept.  In this post, we’ll examine how attributes declared on your model are propagated to the client.  By understanding what is going on behind-the-scenes, you’ll be able to better leverage validation capabilities.</p>  <h3>Code Generation Overview</h3>  <p>The entire RIA Services product is centered around its code generation capabilities.  You create <a title="MSDN: DomainService Class" href="http://msdn.microsoft.com/en-us/library/system.servicemodel.domainservices.server.domainservice(VS.91).aspx" target="_blank">DomainService</a> classes on the server and RIA Services generates <a title="MSDN: Entity Class" href="http://msdn.microsoft.com/en-us/library/system.servicemodel.domainservices.client.entity(VS.91).aspx" target="_blank">Entity</a> classes within your Silverlight project that mimic your model on the server.  You might not ever see the generated code, or even recognize that it’s happening, but it is.  Every time you build your solution, RIA Services generates the classes in your Silverlight project that give you the ability to create, read, update, and delete data, and invoke custom operations within your domain services.</p>  <p><a href="http://jeffhandley.com/images/jeffhandley_com/WindowsLiveWriter/RIAServicesValidationClientPropagation_140B8/image_5.png"><img style="background-image: none; border-right-width: 0px; margin: 0px 0px 0px 10px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="New Silverlight Application dialog - Enable WCF RIA Services" border="0" alt="New Silverlight Application dialog - Enable WCF RIA Services" align="right" src="http://jeffhandley.com/images/jeffhandley_com/WindowsLiveWriter/RIAServicesValidationClientPropagation_140B8/image_thumb.png" width="304" height="242" /></a>I learn best about these types of topics by examining the results—let’s do just that.  I encourage you to walk along with me as we take a brief tour through RIA Service’s generated code.</p>  <ol>   <li>In Visual Studio 2010, create a New Project and select the Silverlight Application template from the Silverlight category.  I will be illustrating C#, but if you primarily use VB, feel free to choose that language for your project.  After entering your project name (“RudeValidation” for me), click OK and you will get the “<strong>New Silverlight Application</strong>” dialog. </li>    <li>In order to utilize WCF RIA Services in your Silverlight application, you’ll need to choose to host the Silverlight application in an ASP.NET Web Application Project, Silverlight 4, and Enable WCF RIA Services.  After setting those options, click OK and two projects will be created in your solution, one with the name you specified and another that is suffixed with .Web. </li>    <li>We need to create a model on the server.  This could be done through Entity Framework, Linq to SQL, NHibernate, or any other data access library.  In our case, we will just create a <a title="Wikipedia: Plain Old CLR Object" href="http://en.wikipedia.org/wiki/Plain_Old_CLR_Object" target="_blank">Plain Old CLR Object (POCO)</a> by creating a new class in our project.  Right-click on your Web project and choose Add –&gt; Class. Name the file “<strong>Meeting.cs</strong>” and click Add. </li>    <li>Our class will be quite simple, but it will require a reference to an additional assembly: <strong>System.ComponentModel.DataAnnotations</strong>.  After adding that reference, we can create our model with the following code: </li> </ol>  <pre style="margin: auto; font-family: "><font size="1"><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">using</font></span><font color="#000000"> System;</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">using</font></span><font color="#000000"> System.ComponentModel.DataAnnotations;</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">namespace</font></span><font color="#000000"> RudeValidation.Web</font></font><br /><font face="Consolas"><font color="#000000">        {</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">class</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">Meeting</font></span></font><br /><font face="Consolas"><font color="#000000">            {</font></font><br /><font face="Consolas"><font color="#000000">                [</font><span style="margin: auto; color: "><font color="#2b91af">Key</font></span><font color="#000000">]</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">int</font></span><font color="#000000"> MeetingId { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">DateTime</font></span><font color="#000000"> Start { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">DateTime</font></span><font color="#000000"> End { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Title { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Details { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Location { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">int</font></span><font color="#000000"> MinimumAttendees { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">int</font></span><font color="#000000"> MaximumAttendees { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">            }</font></font><br /><font face="Consolas"><font color="#000000">        }<img style="background-image: none; border-right-width: 0px; margin: 0px 0px 0px 10px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="Add New Domain Service Class - Empty Domain Service Class" border="0" alt="Add New Domain Service Class - Empty Domain Service Class" align="right" src="http://jeffhandley.com/images/jeffhandley_com/WindowsLiveWriter/RIAServicesValidationClientPropagation_140B8/image_5ec3df61-9a12-4a5f-a943-c972871bda18.png" width="304" height="311" /></font></font></font></pre>

<p> </p>

<ol>
  <li>Our next step is to create a <strong>Domain Service Class</strong> that will expose this Meeting entity to the client, thus triggering code generation to occur. Right-click on the Web project and choose Add –&gt; New Item… again.  This time select “Domain Service Class” from the Web templates.  After naming the class “<strong>MeetingService.cs</strong>” and clicking Add, you will get the “<strong>Add New Domain Service Class</strong>” wizard.  We’re creating an empty Domain Service class, so just click OK. </li>

  <li>By adding a single method to our MeetingService, we can gain access to our Meeting entity in our Silverlight project, and this will allow us to better understand the results of the code generation and continue on to our exploration of validation attribute propagation.  Set your MeetingService.cs file to have the following code, and then build your solution: </li>
</ol>

<pre style="margin: auto; font-family: "><br /><font size="1"><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">namespace</font></span><font color="#000000"> RudeValidation.Web</font></font><br /><font face="Consolas"><font color="#000000">        {</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">using</font></span><font color="#000000"> System.Collections.Generic;</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">using</font></span><font color="#000000"> System.Linq;</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">using</font></span><font color="#000000"> System.ServiceModel.DomainServices.Hosting;</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">using</font></span><font color="#000000"> System.ServiceModel.DomainServices.Server;</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">            [</font><span style="margin: auto; color: "><font color="#2b91af">EnableClientAccess</font></span><font color="#000000">]</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">class</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">MeetingService</font></span><font color="#000000"> : </font><span style="margin: auto; color: "><font color="#2b91af">DomainService</font></span></font><br /><font face="Consolas"><font color="#000000">            {</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">IEnumerable</font></span><font color="#000000">&lt;</font><span style="margin: auto; color: "><font color="#2b91af">Meeting</font></span><font color="#000000">&gt; GetMeetings()</font></font><br /><font face="Consolas"><font color="#000000">                {</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">Enumerable</font></span><font color="#000000">.Empty&lt;</font><span style="margin: auto; color: "><font color="#2b91af">Meeting</font></span><font color="#000000">&gt;();</font></font><br /><font face="Consolas"><font color="#000000">                }</font></font><br /><font face="Consolas"><font color="#000000">            }</font></font><br /><font face="Consolas"><font color="#000000">        }</font></font></font></pre>

<p> </p>

<p>At this point, we have a new Silverlight project, an entity class defined on the server, a DomainService class that exposes it to the client (thanks to the [EnableClientA<img style="background-image: none; border-right-width: 0px; margin: 10px 0px 0px 10px; padding-left: 0px; padding-right: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px; padding-top: 0px" title="image" border="0" alt="image" align="right" src="http://jeffhandley.com/images/jeffhandley_com/WindowsLiveWriter/RIAServicesValidationClientPropagation_140B8/image_df214f05-9078-4e94-8381-6a661adcb1cc.png" width="304" height="253" />ccess] attribute), and our solution is building.  It isn’t obvious, but RIA Services is now generating code within the Silverlight project each time you build.  The generated code is not automatically visible within the Silverlight project, but we can navigate to it easily.</p>

<ol>
  <li>Select the Silverlight project in the Solution Explorer; </li>

  <li>Click on the “<strong>Show All Files</strong>” button, or as <a title="Scott Hanselman's blog" href="http://www.hanselman.com/blog/" target="_blank">Scott Hanselman</a> calls it, the “Don’t Lie To Me” button. </li>

  <li><font face="Arial">You’ll see a <strong>.Web.g.cs</strong> file in the folder – this is what RIA Services has generated for you.  Let’s crack this bad-boy open and see what we have!</font> </li>
</ol>

<p><font face="Arial">You will notice that the generated code includes a handful of types: WebContext, Meeting, MeetingContext, MeetingContext.IMeetingServiceContract, and MeetingContextEntityContainer.  Our focus will be on the Meeting class that is generated.  There are a few notable details for this class:</font></p>
<font face="Arial">
  <ol>
    <li><font face="Arial">It’s a partial class, which means you can create additional files that augment this class beyond what was generated.  You don’t want to edit this .g.cs file, as the next build would overwrite your changes with the re-generated code.  If you expand the “<strong>Extensibility Method Definitions</strong>” region, you’ll see that there is a series of partial methods that you can implement in your partial class file.</font> </li>

    <li><font face="Arial">The class derives from <strong>Entity</strong>, which is a framework class in RIA Services, and it provides loads of functionality that makes RIA Services tick.</font> </li>

    <li><font face="Arial">Every property setter has significant logic, such as:</font> </li>
  </ol>

  <pre style="margin: auto; font-family: "><font size="1"><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#808080">///</font></span><span style="margin: auto; color: "><font color="#008000"> </font></span><span style="margin: auto; color: "><font color="#808080">&lt;summary&gt;</font></span></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#808080">///</font></span><span style="margin: auto; color: "><font color="#008000"> Gets or sets the 'Title' value.</font></span></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#808080">///</font></span><span style="margin: auto; color: "><font color="#008000"> </font></span><span style="margin: auto; color: "><font color="#808080">&lt;/summary&gt;</font></span></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">DataMember</font></span><font color="#000000">()]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Title</font></font><br /><font face="Consolas"><font color="#000000">        {</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span></font><br /><font face="Consolas"><font color="#000000">            {</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">._title;</font></font><br /><font face="Consolas"><font color="#000000">            }</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span></font><br /><font face="Consolas"><font color="#000000">            {</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">if</font></span><font color="#000000"> ((</font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">._title != </font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">))</font></font><br /><font face="Consolas"><font color="#000000">                {</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.OnTitleChanging(</font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.RaiseDataMemberChanging(</font><span style="margin: auto; color: "><font color="#a31515">"Title"</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.ValidateProperty(</font><span style="margin: auto; color: "><font color="#a31515">"Title"</font></span><font color="#000000">, </font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">._title = </font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">;</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.RaiseDataMemberChanged(</font><span style="margin: auto; color: "><font color="#a31515">"Title"</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.OnTitleChanged();</font></font><br /><font face="Consolas"><font color="#000000">                }</font></font><br /><font face="Consolas"><font color="#000000">            }</font></font><br /><font face="Consolas"><font color="#000000">        }</font></font></font></pre>

  <p> </p>

  <p>We will examine this property setter logic in a subsequent post.  But at this point, we can see how properties created on our model on the server translate into Entity classes in our Silverlight project, and how every property declared on the server is represented on the client.  Our next step is to apply some standard validators to our model and review the effects this has on our generated code.</p>

  <h3>Validation Attribute Propagation</h3>

  <p>Now that we’ve seen that RIA Services is performing code generation for our entities, we recognize that validation attributes applied on the server must somehow get propagated to the client, in the Silverlight project’s rendition of the entity class.  Let’s again study this by looking at the results of the code generation.  Revisiting the post on <a title="WCF RIA Services: Standard Validators" href="http://jeffhandley.com/archive/2010/09/22/RiaServicesStandardValidators.aspx" target="_blank">Standard Validators</a>, let’s apply the same validators we’d used in there.  And in addition to the validation attributes, we’ll also use the <strong>[Display]</strong> attribute.</p>

  <pre style="margin: auto; font-family: "><font size="1"><font face="Consolas"><font color="#000000">    </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">class</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">Meeting</font></span></font><br /><font face="Consolas"><font color="#000000">    {</font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Key</font></span><font color="#000000">]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">int</font></span><font color="#000000"> MeetingId { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Required</font></span><font color="#000000">]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">DateTime</font></span><font color="#000000"> Start { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Required</font></span><font color="#000000">]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#2b91af">DateTime</font></span><font color="#000000"> End { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Required</font></span><font color="#000000">]</font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">StringLength</font></span><font color="#000000">(80, MinimumLength = 5)]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Title { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Details { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Required</font></span><font color="#000000">]</font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">RegularExpression</font></span><font color="#000000">(</font><span style="margin: auto; color: "><font color="#a31515">@"\d{1,3}/\d{4}"</font></span><font color="#000000">,</font></font><br /><font face="Consolas"><font color="#000000">            ErrorMessage = </font><span style="margin: auto; color: "><font color="#a31515">"{0} must be in the format of 'Building/Room'"</font></span><font color="#000000">)]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Location { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Range</font></span><font color="#000000">(2, 100)]</font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Display</font></span><font color="#000000">(Name = </font><span style="margin: auto; color: "><font color="#a31515">"Minimum Attendees"</font></span><font color="#000000">)]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">int</font></span><font color="#000000"> MinimumAttendees { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000"> </font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Range</font></span><font color="#000000">(2, 100)]</font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Display</font></span><font color="#000000">(Name = </font><span style="margin: auto; color: "><font color="#a31515">"Maximum Attendees"</font></span><font color="#000000">)]</font></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">int</font></span><font color="#000000"> MaximumAttendees { </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span><font color="#000000">; </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span><font color="#000000">; }</font></font><br /><font face="Consolas"><font color="#000000">    }</font></font><br /></font></pre>

  <div> </div>

  <p><em>The only difference between this code and what was used in the Standard Validators post is that we’re no longer using the ErrorMessageResourceType/ErrorMessageResourceName properties on the StringLength validator.  We’ll cover how to use resources for error messages in a later article. 
      <br /></em></p>

  <div> </div>

  <div>Let’s build our project after applying these attributes, and switch back to our generated code (if you left the file open, Visual Studio will alert you that it has been changed after you build).  In our generated code, let’s navigate back to the Meeting.Title property to see how the <strong>[Required]</strong> and <strong>[StringLength]</strong> attributes affected it.</div>

  <div> </div>

  <pre style="margin: auto; font-family: "><font size="1"><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#808080">///</font></span><span style="margin: auto; color: "><font color="#008000"> </font></span><span style="margin: auto; color: "><font color="#808080">&lt;summary&gt;</font></span></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#808080">///</font></span><span style="margin: auto; color: "><font color="#008000"> Gets or sets the 'Title' value.</font></span></font><br /><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#808080">///</font></span><span style="margin: auto; color: "><font color="#008000"> </font></span><span style="margin: auto; color: "><font color="#808080">&lt;/summary&gt;</font></span></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">DataMember</font></span><font color="#000000">()]</font></font><br /><font face="Consolas"><font color="#000000" /><font size="1"><font face="Consolas"><font color="#000000"><font size="1"><font face="Consolas"><font color="#000000" /></font></font></font></font><font size="1"><font size="1"><font face="Consolas"><font size="1"><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">Required</font></span><font color="#000000">()]</font></font><br /><font face="Consolas"><font color="#000000">        [</font><span style="margin: auto; color: "><font color="#2b91af">StringLength</font></span><font color="#000000">(80, MinimumLength=5)]</font></font></font><br /></font><font size="1"><font face="Consolas"><font color="#000000">        </font><span style="margin: auto; color: "><font color="#0000ff">public</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">string</font></span><font color="#000000"> Title</font></font><br /></font><font size="1"><font face="Consolas"><font color="#000000">        {</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">get</font></span></font><br /><font face="Consolas"><font color="#000000">            {</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">return</font></span><font color="#000000"> </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">._title;</font></font><br /><font face="Consolas"><font color="#000000">            }</font></font><br /><font face="Consolas"><font color="#000000">            </font><span style="margin: auto; color: "><font color="#0000ff">set</font></span></font><br /><font face="Consolas"><font color="#000000">            {</font></font><br /><font face="Consolas"><font color="#000000">                </font><span style="margin: auto; color: "><font color="#0000ff">if</font></span><font color="#000000"> ((</font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">._title != </font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">))</font></font><br /><font face="Consolas"><font color="#000000">                {</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.OnTitleChanging(</font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.RaiseDataMemberChanging(</font><span style="margin: auto; color: "><font color="#a31515">"Title"</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.ValidateProperty(</font><span style="margin: auto; color: "><font color="#a31515">"Title"</font></span><font color="#000000">, </font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">._title = </font><span style="margin: auto; color: "><font color="#0000ff">value</font></span><font color="#000000">;</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.RaiseDataMemberChanged(</font><span style="margin: auto; color: "><font color="#a31515">"Title"</font></span><font color="#000000">);</font></font><br /><font face="Consolas"><font color="#000000">                    </font><span style="margin: auto; color: "><font color="#0000ff">this</font></span><font color="#000000">.OnTitleChanged();</font></font><br /><font face="Consolas"><font color="#000000">                }</font></font><br /><font face="Consolas"><font color="#000000">            }</font></font><br /><font face="Consolas"><font color="#000000">        }</font></font></font></font></font></font></font></font></pre>
</font><font face="Arial"><font size="1">
    <p> </p>

    <p>That’s pretty straight-forward, isn’t it?  The attributes we applied on the server have been discovered and generated on the client, in a 1:1 manner.  Here’s what’s happening:</p>

    <ol>
      <li>RIA Services finds all classes in your Web project that derive from <strong>DomainService</strong>; </li>

      <li>Your entity types are then discovered by convention, recognizing that <strong>GetMeetings()</strong> returns an <strong>IEnumerable&lt;Meeting&gt;</strong>, which implies that you want to be able to work with your <strong>Meeting</strong> class on the client; </li>

      <li>The Meeting class is then reflected upon, and all properties are catalogued.  As long as the property is a type that can be serialized by RIA Services, and it doesn’t have the <strong>[Exclude]</strong> attribute on it, it will be included in the Silverlight version of the class. </li>

      <li>For each property, all of the attributes are enumerated.  For every attribute, the attribute type is sought in the Silverlight project.  It can be found a couple different ways: 
        <ol>
          <li>The attribute class is defined within a .shared.cs file in the Web project, which then triggers RIA Services to automatically copy this file to the Silverlight project (within the Generated_Code folder) – This is called a Shared Type. </li>

          <li>The attribute class is defined within a class library that is referenced by the Web project, and the Silverlight project references a Silverlight class library that also defines the class (in the same namespace).  Note that this can be achieved either by implementing the class in both class libraries, or by using a <strong>WCF RIA Services Class Library</strong> and utilizing the .shared.cs file name convention within the Web class library. </li>
        </ol>
      </li>

      <li>For each attribute that is found to exist on both the server and the client, the attribute is verified to meet construction requirements: 
        <ol>
          <li>There must be a public constructor defined within the class (the base constructor is not sufficient) that has the same signature as the constructor used on the Web project; </li>

          <li>Every public property on the Web version of the attribute must have a corresponding property in Silverlight with an accessible setter. </li>
        </ol>
      </li>
    </ol>

    <p>In other words, so long as the exact same attribute declaration can be used on both the server and client, the attribute will be propagated.  The biggest exception to this is that the Silverlight version of the attribute cannot exist as a standalone class within the main Silverlight project—it must be either referenced or included through the .shared.cs file name convention.</p>

    <h3>Custom Validation</h3>

    <p>When using the <strong>[CustomValidation]</strong> attribute, there are some additional constraints that you must abide by.  Because your attribute will be propagated to the client as-is, the <strong>ValidatorType</strong> and <strong>Method</strong> specified for the custom validation must also be available on the client.  This is most often achieved using the .shared.cs file name convention, as mentioned in the <a title="RIA Services Validation: Custom Validation Methods" href="/archive/2010/09/25/RiaServicesCustomValidationMethods.aspx" target="_blank">Custom Validation Methods</a> post.  However, this can also be done using the class library approach.</p>

    <p>If you have a [CustomValidation] attribute that does not work properly on the client, you’ll either get a build error stating that the type cannot be found, or you will get a runtime error saying the validation method cannot be found.  It should be pretty apparent either way, so if you hit those scenarios, be sure that your validator type and method are discoverable in your Silverlight project.</p>

    <h3>Validation Execution</h3>

    <p>Now that your validation attributes are propagated to the Silverlight project, the client UI can now execute your validators without having to go back to the server.  RIA Services and Silverlight use the static <a title="MSDN: Validator Class" href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.validator.aspx" target="_blank">Validator</a> class in the <a title="MSDN: System.ComponentModel.DataAnnotations Namespace" href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.aspx" target="_blank">System.ComponentModel.DataAnnotations</a> assembly and namespace to perform this validation.  You can read about <a title="Validating Objects and Properties with Validator" href="http://jeffhandley.com/archive/2009/10/16/validator.aspx" target="_blank">how the Validator class works in my post</a> from last year.  For specifics on when and how this validation occurs, you’ll have to keep following along, as we’ll cover that topic in my next post!</p>

    <h3>RIA Services Validation Recap:</h3>

    <p>This post is part of an ongoing series on RIA Services Validation.  We have now learned how the attributes you declare on the server get propagated to your client code through RIA Services code generation.  Hopefully, you now feel empowered to explore new ways to apply validators to your model.  In fact, I implore you to look through the generated code for the other validators we applied, along with the [Display] attribute that we included in our model.  Then, try deriving from <strong>ValidationAttribute</strong> in both a .shared.cs file as well as in a <strong>WCF RIA Services Class Library</strong>.  As you make changes, study the effects on the generated code.</p>

    <p>Here are the other posts in this series:</p>

    <ol>
      <ol>
        <li><a title="RIA Services Validation: Standard Validators" href="http://jeffhandley.com/archive/2010/09/22/RiaServicesStandardValidators.aspx">Standard Validators</a> </li>

        <li><a title="RIA Services Validation: Custom Validation Methods" href="/archive/2010/09/25/RiaServicesCustomValidationMethods.aspx">Custom Validation Methods</a> </li>

        <li><a title="RIA Services Validation: Custom Reusable Validators" href="/archive/2010/09/26/RiaServicesCustomReusableValidators.aspx" target="_blank">Custom Reusable Validators</a> </li>

        <li><a title="RIA Services Validation: Attribute Propagation" href="/archive/2010/09/30/RiaServicesValidationAttributePropagation.aspx">Attribute Propagation</a> </li>

        <li><a href="/archive/2010/10/06/RiaServicesValidationTriggers.aspx">Validation Triggers</a> </li>

        <li><a title="RIA Services Validation: Cross-Field Validation" href="/archive/2010/10/10/CrossFieldValidation.aspx">Cross-Field Validation</a> </li>

        <li><a title="RIA Services Validation: Entity-Level Validation" href="/archive/2010/10/12/EntityLevelValidation.aspx">Entity-Level Validation</a> </li>

        <li><a title="RIA Services Validation: Providing ValidationContext" href="/archive/2010/10/25/RiaServicesValidationContext.aspx">Providing ValidationContext</a> </li>

        <li><a title="RIA Services Validation: Using ValidationContext (Cross-Entity Validation)" href="/archive/2010/10/25/CrossEntityValidation.aspx">Using ValidationContext (Cross-Entity Validation)</a> </li>

        <li><a title="RIA Services Validation: ViewModel Validation with Entity Rules" href="http://jeffhandley.com/archive/2011/09/06/ViewModelValidation.aspx">ViewModel Validation with Entity Rules</a> </li>
      </ol>
    </ol>

    <p><strong><em>[9/6/2011] The source code for everything shown during the series is <a title="RIA Services Validation: Available on GitHub" href="http://jeffhandley.com/archive/2011/09/06/RIA-Services-Validation-Available-on-GitHub.aspx">available on GitHub</a>.</em></strong></p>

    <h3>Digging Deeper</h3>

    <p>As mentioned, my next post will go into details on when and how RIA Services performs validation.  We’ll then continue to explore more details of the RIA Services validation features over many other posts that will cover how to perform entity-level validation, how to leverage ValidationContext, and more.</p>

    <div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:42166667-88b9-4c3d-bab9-a86cb44d79b4" class="wlWriterEditableSmartContent">Technorati Tags: <a href="http://technorati.com/tags/RiaServicesValidation" rel="tag">RiaServicesValidation</a>,<a href="http://technorati.com/tags/RiaServices" rel="tag">RiaServices</a>,<a href="http://technorati.com/tags/Validation" rel="tag">Validation</a>,<a href="http://technorati.com/tags/Silverlight" rel="tag">Silverlight</a>,<a href="http://technorati.com/tags/DataAnnotations" rel="tag">DataAnnotations</a></div>
  </font></font><font face="Arial"><font size="1" /></font>

