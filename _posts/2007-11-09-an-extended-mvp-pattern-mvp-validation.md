---
layout: post
title: "An Extended MVP Pattern (MVP Validation)"
date: 2007-11-09 11:43:24 -0800
comments: true
category: Archive
tags: []
redirect_from: ["/archive/2007/11/09/an-extended-mvp-pattern-mvp-validation.aspx/"]
author: 0
---
<!-- more -->
<p>Until last year, I had never used an MVP/MVC pattern before.  I had read about the patterns at <a href="http://www.MartinFowler.com" target="_blank">Martin Fowler's site</a>, although the Model View Presenter pattern has since been <a href="http://martinfowler.com/eaaDev/ModelViewPresenter.html" target="_blank">retired</a>.  I had also seen some posts and demos and talks where people were using MVC/MVP frameworks.  But I kept thinking there was something missing.  I couldn't put my finger on it for a long time, but I just had that gut feeling that something wasn't covered.</p>  <p>Last year though, I was assigned to a new project, for the first time in a few years.  The new project was going to be WinForms.  After getting up to speed on requirements, I started thinking pretty hard about using MVP for the project.  Once I focused on it, I figured out what I thought was missing from everything I had seen about MVP (and MVC).</p>  <p>Here's a diagram right from Martin Fowler's site:<img id="id" src="http://martinfowler.com/eaaDev/passiveScreen/asssesIntermed-cd.gif" />     <br /><a title="http://martinfowler.com/eaaDev/PassiveScreen.html" href="http://martinfowler.com/eaaDev/PassiveScreen.html">http://martinfowler.com/eaaDev/PassiveScreen.html</a></p>  <p>This shows an interface that includes actualValue, varianceValue and varianceColor.  These are scalar values that can be injected into the View.  Dealing with scalar values seemed to be commonplace throughout everything I had seen using MVC or MVP.  The controller or presenter can update the view's scalar values, and the view displays those values.</p>  <p>One problem stuck out to me like a sore thumb.  When editing a record, how does the presenter tell the view if a certain field is not editable?  After asking some folks that I know that had been using MVC or MVP, they replied with a rather simple solution.  The view interface defines a boolean field for whether or not the field is enabled.  The view then uses that to enable/disable the field appropriately.  Others stated they used events to manage this.  And in both cases, the presenter must trust that the view handles it.</p>  <p>This wasn't good enough for me; I was thinking bigger.  How is client-side validation wired up?  When server-side validation occurs, how does the presenter know how to generate the error message if only the view knows how the field was presented to the user?</p>  <p>In order to answer these questions, I thought about how I've addressed those problems in a Web Forms system.  For me, that's easy: <a href="http://oldblog.jeffhandley.com/index.php/2005/05/22/custom-web-controls-everywhere/" target="_blank">Custom Web Controls Everywhere!</a>  I've been preaching custom controls "everywhere" for a long time now.  Heck, I gave that presentation nearly 2½ years ago, and the concept was old to me then.</p>  <p>At <a href="http://www.bigsolutions.com" target="_blank">BIG</a>, I developed a TextBox control that we've used on several projects.  The control can validate itself with any of the ASP.NET validators, in a very simple fashion:</p>  <div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; overflow: auto; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 200px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, 'Courier New', courier, monospace; background-color: #f4f4f4">   <div style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none">     <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 1:</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">BIG:TextBox</span> <span style="color: #ff0000">Runat</span><span style="color: #0000ff">="server"</span> <span style="color: #ff0000">ID</span><span style="color: #0000ff">="txtHomePhone"</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 2:</span> <span style="color: #ff0000">FieldName</span><span style="color: #0000ff">="Home Number"</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 3:</span> <span style="color: #ff0000">Required-Enabled</span><span style="color: #0000ff">="True"</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 4:</span> <span style="color: #ff0000">Format</span><span style="color: #0000ff">="Phone"</span> <span style="color: #0000ff">/&gt;</span></pre>
  </div>
</div>

<p>This would result in a TextBox that has the correct max length, size, regular expression validator, required field validator, an error indicator consistent with the rest of the application, error messages stating "Phone Number is required" and "Home Phone is not a valid phone number."  Additionally, the presentation of the textbox is altered to indicate that it's required.  The DASL project renders a little lightning bolt icon next to any required textbox.  The control actually has dozens of other features too, but we'll stop there.</p>

<p>On another project here at BIG, Ben Von Handorf created something he called "Reflections on Validation."  He <a href="http://cinnug.org/blogs/blog/archive/2005/09/28/62.aspx" target="_blank">presented this at CINNUG</a> only a few months after I presented custom web controls everywhere.  Ben had taken my textbox to the next level by wiring it all the way into the business layer.  Now, the textbox became as simple as this:</p>

<div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; overflow: auto; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 200px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, 'Courier New', courier, monospace; background-color: #f4f4f4">
  <div style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none">
    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 1:</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">BIG:TextBox</span> <span style="color: #ff0000">Runat</span><span style="color: #0000ff">="server"</span> <span style="color: #ff0000">ID</span><span style="color: #0000ff">="txtHomePhone"</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 2:</span> <span style="color: #ff0000">FieldName</span><span style="color: #0000ff">="Home Phone"</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 3:</span> <span style="color: #ff0000">Property</span><span style="color: #0000ff">="HomePhone"</span> <span style="color: #0000ff">/&gt;</span></pre>
  </div>
</div>

<p>The rest of the stuff on the textbox got wired up from his object validation engine in the business layer, with only a small hook from the UI layer.  He used custom attributes to create validation attributes like this:</p>

<div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; overflow: auto; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 200px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, 'Courier New', courier, monospace; background-color: #f4f4f4">
  <div style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none">
    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 1:</span> [Validation.Required]</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 2:</span> [Validation.Format(Validation.Formats.Phone)]</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 3:</span> <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> HomePhone</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 4:</span> {</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 5:</span> get { <span style="color: #0000ff">return</span> _homePhone; }</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 6:</span> set { _homePhone = <span style="color: #0000ff">value</span>; }</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 7:</span> }</pre>
  </div>
</div>

<p>Now, that's just brilliant.  Or, at least it was back in 2005!  It's commonplace now, and I like to think Ben was one of the pioneers behind this.</p>

<p>I wanted all of this goodness in my MVP pattern.  What I ended up coming up with was a totally new (as far as I know) flavor of MVP.  This pattern doesn't pass scalar values around; instead it deals with control interfaces.  It can best be explained by showing a sample view interface:</p>

<div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; overflow: auto; border-left: gray 1px solid; width: 98.03%; cursor: text; max-height: 270px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, 'Courier New', courier, monospace; height: 326px; background-color: #f4f4f4">
  <div style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none">
    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 1:</span> <span style="color: #0000ff">public</span> ICustomerEditView</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 2:</span> {</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 3:</span> [Validation.Required]</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 4:</span> ITextBox txtFirstName;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 5:</span>  </pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 6:</span> ITextBox txtMiddleName;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 7:</span>  </pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 8:</span> [Validation.Required]</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 9:</span> ITextBox txtLastName;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 10:</span>  </pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 11:</span> ITextBox txtAddress;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 12:</span> ITextBox txtCity;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 13:</span> IComboBox cboState;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 14:</span> ITextBox txtZipCode;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 15:</span> ICheckBox chkOnMailingList;</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 16:</span> }</pre>
  </div>
</div>

<p>That's right, instead of exposing the fields from the view as scalar values, let's expose them as control interfaces.  We can then build out our control interfaces to support whatever we need the presenter to manage for us.  The first thing we add is ITextBox.Text as a string.  So we can still manipulate the scalar value, but through its control.  Then for any form field, we expose an Enabled property (via an IFormField interface of course), and the presenter can manage whether or not the field is editable.</p>

<p>Now, it could probably go without saying that in order to implement this, you have to employ custom controls everywhere.  But that's okay, because I do that anyway.  Even when I don't know of any functionality to add to a control, or any presentation or behavior to override, I inherit the stock class, just in case.  So now, I inherit from the stock TextBox control, and I implement ITextBox.  I like the side effect here that this really forces you to use custom controls <u>everywhere</u>.</p>

<p>Once I really started thinking about the idea, it became very easy to solve some otherwise difficult problems, before I ever wrote a single line of code.  For instance, how does the presenter know how to format an error message if the view was responsible for rendering the form?</p>

<p>A simple example is when you allow a customer to put 2 phone numbers on the form.  Let's assume the following form content:</p>

<div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; overflow: auto; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 200px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, 'Courier New', courier, monospace; background-color: #f4f4f4">
  <div style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none">
    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 1:</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">tr</span><span style="color: #0000ff">&gt;</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 2:</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">td</span> <span style="color: #ff0000">class</span><span style="color: #0000ff">="FormLabel"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">BIG:Label</span> <span style="color: #ff0000">Runat</span><span style="color: #0000ff">="server"</span> <span style="color: #ff0000">ID</span><span style="color: #0000ff">="lblHomePhone"</span> <span style="color: #ff0000">Text</span><span style="color: #0000ff">="Home Phone"</span> <span style="color: #0000ff">/&gt;</span>:<span style="color: #0000ff">&lt;/</span><span style="color: #800000">td</span><span style="color: #0000ff">&gt;</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 3:</span> <span style="color: #0000ff">&lt;</span><span style="color: #800000">td</span> <span style="color: #ff0000">class</span><span style="color: #0000ff">="FormField"</span><span style="color: #0000ff">&gt;&lt;</span><span style="color: #800000">BIG:TextBox</span> <span style="color: #ff0000">Runat</span><span style="color: #0000ff">="server"</span> <span style="color: #ff0000">ID</span><span style="color: #0000ff">="txtHomePhone"</span> <span style="color: #ff0000">LabelID</span><span style="color: #0000ff">="lblHomePhone"</span> <span style="color: #0000ff">/&gt;&lt;/</span><span style="color: #800000">td</span><span style="color: #0000ff">&gt;</span></pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 4:</span> <span style="color: #0000ff">&lt;/</span><span style="color: #800000">tr</span><span style="color: #0000ff">&gt;</span></pre>
  </div>
</div>

<p>(yeah, yeah, <a href="http://arcware.net/archive/2006/02/12/5871.aspx" target="_blank">I still use table-based layouts, but hey, they still work</a>)</p>

<p>Notice the textbox references the label?  What ends up happening is ITextBox contains a field for FieldLabel as an ILabel.  The TextBox custom control implementation takes the LabelID value, finds the ILabel control that it's referencing, and exposes that control as ITextBox.FieldLabel.</p>

<p>Our presenter is now empowered with the following capability:</p>

<div style="border-right: gray 1px solid; padding-right: 4px; border-top: gray 1px solid; padding-left: 4px; font-size: 8pt; padding-bottom: 4px; margin: 20px 0px 10px; overflow: auto; border-left: gray 1px solid; width: 97.5%; cursor: text; max-height: 200px; line-height: 12pt; padding-top: 4px; border-bottom: gray 1px solid; font-family: consolas, 'Courier New', courier, monospace; background-color: #f4f4f4">
  <div style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none">
    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: white; border-bottom-style: none"><span style="color: #606060"> 1:</span> errorMessages.Add(<span style="color: #0000ff">string</span>.Format(<span style="color: #006080">"{0} is required"</span>, txtHomePhone.FieldLabel.Text));</pre>

    <pre style="padding-right: 0px; padding-left: 0px; font-size: 8pt; padding-bottom: 0px; margin: 0em; overflow: visible; width: 100%; color: black; border-top-style: none; line-height: 12pt; padding-top: 0px; font-family: consolas, 'Courier New', courier, monospace; border-right-style: none; border-left-style: none; background-color: #f4f4f4; border-bottom-style: none"><span style="color: #606060"> 2:</span> errorMessages.Add(<span style="color: #0000ff">string</span>.Format(<span style="color: #006080">"{0} is not a valid phone number"</span>, txtHomePhone.FieldLabel.Text));</pre>
  </div>
</div>

<p>Now that you can see the power that is available to us, I'm going to leave some things to your imagination for awhile.  But I'll give you some hints about where this framework went.  We have reflection-based validation and security (including view- and field-level security), controls automatically reformat themselves based on what validation and security rules have been applied, and we have tooltips on the field labels that show a summary of what rules have been applied.  This ended up being the friendliest UI I've ever built--it tells the user everything about what's going on.</p>

<p>I will write more about this, but please feel free to hit me with whatever questions or comments you have.  And in the coming weeks, I hope to try to bolt this framework on top of the ASP.NET MVC framework coming out, to see how well it plugs in.</p>

<p><em>It feels great to finally get this written too!  I've been wanting to write this post for about 16 months, but I've never found the time before.</em></p>

<p><em>Also, I provided ASPX samples, but each of the projects on which we've implemented this framework has been WinForms.  It's just easier to show sample ASPX markup.  And besides, the pattern will work for either type of project in the same way--only the custom controls would be different.</em></p>

<div class="wlWriterSmartContent" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:d41f7e62-31f9-4a3d-a348-46c3a3aa49f2" style="padding-right: 0px; display: inline; padding-left: 0px; float: none; padding-bottom: 0px; margin: 0px; padding-top: 0px">Technorati Tags: 
		<a href="http://technorati.com/tags/MVP/" rel="tag">MVP</a>
		, 
		<a href="http://technorati.com/tags/MVC/" rel="tag">MVC</a>
		, 
		<a href="http://technorati.com/tags/ASP.NET/" rel="tag">ASP.NET</a>
		, 
		<a href="http://technorati.com/tags/.NET/" rel="tag">.NET</a>
		, 
		<a href="http://technorati.com/tags/Validation/" rel="tag">Validation</a>
		, 
		<a href="http://technorati.com/tags/.NET%20Reflection/" rel="tag">.NET Reflection</a>
		</div>

