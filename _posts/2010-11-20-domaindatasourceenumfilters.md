---
layout: post
title: "DomainDataSource Enum Filters"
date: 2010-11-20 02:10:49 -0800
comments: true
tags: ["RIAServices", "DomainDataSource"]
redirect_from: ["/archive/2010/11/19/DomainDataSourceEnumFilters.aspx/", "/archive/2010/11/19/domaindatasourceenumfilters.aspx"]
author: "Jeff Handley"
---
<!-- more -->
<p>In early pre-release versions of RIA Services, the DomainDataSource control did not support filter descriptors for Enum properties.  We were able to get this fixed for our V1.0 RC release though, and I mentioned that <a title="DomainDataSource Filters and Parameters" href="/archive/2010/03/15/filters-parameters.aspx" target="_blank">back in March</a>.  I said in that post that I’d follow up with details about our Enum support, but I never did (until now).</p>  <p>Someone actually called me out on this by <a href="/archive/2010/03/15/filters-parameters.aspx#915" target="_blank">commenting on the post</a>.  However, I thought the details of the comment were a bit humorous.  Here’s what I received in my inbox:</p>  <p><img style="display: inline" title="You mentioned enum filters are now supported.  Can you point me to any documentation for enum filters?" alt="You mentioned enum filters are now supported.  Can you point me to any documentation for enum filters?" src="http://jeffhandley.com/images/jeffhandley_com/Windows-Live-Writer/DomainDataSource-Enum-Filters_D8DB/EnumFilterHelp.png" width="643" height="286" /></p>  <p>So, you’ve asked me to point you to documentation, but you said your name is “Enum Filters,” you left no email address, and no Url.  Oh well, my blog is the right place to answer anyway, so here ‘goes.</p>  <p><em>As an aside: when commenting on my blog, the email address you leave will be used for two things and two things only:</em></p>  <ol>   <li><em>As the from address in the email I receive, so that I can reply to you (I do my best to reply to people); and</em> </li>    <li><em>Your Gravatar image.</em> </li> </ol>  <p>I’ve defined the following model that I want to expose through RIA Services: <em>Automobile.cs within the Web project</em></p>  <div id="codeSnippetWrapper">   <div id="codeSnippetWrapper">     <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">using</span> System.ComponentModel.DataAnnotations;<br /> <br /><span style="color: #0000ff">namespace</span> EnumFilters.Web<br />{<br />    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> Automobile<br />    {<br />        [Key]<br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">int</span> Id { get; set; }<br /> <br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">int</span> Year { get; set; }<br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> Make { get; set; }<br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> Model { get; set; }<br />        <span style="color: #0000ff">public</span> <span style="color: #0000ff">string</span> TrimLevel { get; set; }<br /><br />        <span style="color: #0000ff">public</span> AutoType Type { get; set; }<br />    }<br /> <br />    <span style="color: #0000ff">public</span> <span style="color: #0000ff">enum</span> AutoType<br />    {<br />        Coupe,<br />        Sedan,<br />        Wagon,<br />        Pickup,<br />        SUV,<br />        Van<br />    }<br />}<br /></pre>

    <br /></div>

  <div> </div>
</div>

<p><strong><em>NOTE: You CANNOT nest the Enum type within an entity type.  RIA Services DOES NOT SUPPORT nested types.</em></strong></p>

<p>I then created the following DomainService to expose some automobiles: <em>AutomobileService.cs within the Web project</em></p>

<div id="codeSnippetWrapper">
  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">namespace</span> EnumFilters.Web<br />{<br />    <span style="color: #0000ff">using</span> System.Linq;<br />    <span style="color: #0000ff">using</span> System.ServiceModel.DomainServices.Hosting;<br />    <span style="color: #0000ff">using</span> System.ServiceModel.DomainServices.Server;<br /> <br />    [EnableClientAccess()]<br />    <span style="color: #0000ff">public</span> <span style="color: #0000ff">class</span> AutomobileService : DomainService<br />    {<br />        <span style="color: #0000ff">private</span> <span style="color: #0000ff">static</span> <span style="color: #0000ff">readonly</span> Automobile[] automobileList = <span style="color: #0000ff">new</span>[]<br />            {<br />                <span style="color: #0000ff">new</span> Automobile<br />                {<br />                    Id = 1, Year = 1983,<br />                    Make = <span style="color: #006080">"Volkswagon"</span>, Model = <span style="color: #006080">"Jetta"</span>,<br />                    Type = AutoType.Sedan<br />                },<br />                <span style="color: #0000ff">new</span> Automobile<br />                {<br />                    Id = 2, Year = 1992,<br />                    Make = <span style="color: #006080">"Plymouth"</span>, Model = <span style="color: #006080">"Sundance"</span>,<br />                    TrimLevel = <span style="color: #006080">"America"</span>, Type = AutoType.Coupe<br />                },<br />                <span style="color: #0000ff">new</span> Automobile<br />                {<br />                    Id = 3, Year = 2000,<br />                    Make = <span style="color: #006080">"Subaru"</span>, Model = <span style="color: #006080">"Impreza"</span>,<br />                    TrimLevel = <span style="color: #006080">"2.5RS"</span>, Type = AutoType.Coupe<br />                }<br />            };<br /> <br />        <span style="color: #0000ff">public</span> IQueryable&lt;Automobile&gt; GetAutomobiles()<br />        {<br />            <span style="color: #0000ff">return</span> AutomobileService.automobileList.AsQueryable();<br />        }<br />    }<br />}<br /></pre>

  <br /></div>

<p>Now, in the <em>Home.xaml file within my Views folder in the Silverlight project</em>, I can define the following:</p>

<div id="codeSnippetWrapper">
  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">&lt;</span><span style="color: #800000">riaControls:DomainDataSource</span> <span style="color: #ff0000">AutoLoad</span><span style="color: #0000ff">="True"</span> <span style="color: #ff0000">d:DesignData</span><span style="color: #0000ff">="{d:DesignInstance my:Automobile, CreateList=true}"</span><br />                              <span style="color: #ff0000">QueryName</span><span style="color: #0000ff">="GetAutomobilesQuery"</span> <span style="color: #ff0000">Width</span><span style="color: #0000ff">="0"</span><span style="color: #0000ff">&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">riaControls:DomainDataSource.DomainContext</span><span style="color: #0000ff">&gt;</span><br />        <span style="color: #0000ff">&lt;</span><span style="color: #800000">my:AutomobileContext</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">riaControls:DomainDataSource.DomainContext</span><span style="color: #0000ff">&gt;</span><br />    <span style="color: #0000ff">&lt;</span><span style="color: #800000">riaControls:DomainDataSource.FilterDescriptors</span><span style="color: #0000ff">&gt;</span><br />        <span style="color: #0000ff">&lt;</span><span style="color: #800000">riaControls:FilterDescriptor</span> <span style="color: #ff0000">PropertyPath</span><span style="color: #0000ff">="Type"</span><br />                                      <span style="color: #ff0000">Operator</span><span style="color: #0000ff">="IsEqualTo"</span><br />                                      <span style="color: #ff0000">Value</span><span style="color: #0000ff">="{Binding ElementName=AutoType, Path=SelectedItem}"</span><br />                                      <span style="color: #ff0000">IgnoredValue</span><span style="color: #0000ff">="{x:Null}"</span> <span style="color: #0000ff">/&gt;</span><br />    <span style="color: #0000ff">&lt;/</span><span style="color: #800000">riaControls:DomainDataSource.FilterDescriptors</span><span style="color: #0000ff">&gt;</span><br /><span style="color: #0000ff">&lt;/</span><span style="color: #800000">riaControls:DomainDataSource</span><span style="color: #0000ff">&gt;</span><br /><span style="color: #0000ff">&lt;</span><span style="color: #800000">ComboBox</span> <span style="color: #ff0000">x:Name</span><span style="color: #0000ff">="AutoType"</span> <span style="color: #ff0000">Width</span><span style="color: #0000ff">="150"</span> <span style="color: #ff0000">HorizontalAlignment</span><span style="color: #0000ff">="Center"</span> <span style="color: #0000ff">/&gt;</span><br /></pre>

  <br /></div>

<p>The key is that I have defined a FilterDescriptor whose value is pulled from the SelectedItem property of a ComboBox.  Using the IgnoredValue property with its value set to {x:Null} allows the filter to be ignored if the ComboBox has no selection.  If you don’t specify that IgnoredValue and your ComboBox has no selection, then you’ll get an error when the DomainDataSource attempts to load.</p>

<p>We still need to put items into the ComboBox though.  There are various ways to do this, but I decided to grab all of the members of the Enum type and put them in as string values.  Here’s the code I have in <em>Home.xaml.cs</em> within the <em>OnNavigatedTo</em> event handler:</p>

<div id="codeSnippetWrapper">
  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet"><span style="color: #0000ff">this</span>.AutoType.ItemsSource = from member <span style="color: #0000ff">in</span> <span style="color: #0000ff">typeof</span>(AutoType)<br />                                .GetMembers(BindingFlags.Public | BindingFlags.Static)<br />                            select member.Name;<br /></pre>

  <br /></div>

<p>The DomainDataSource can take the string Enum value name and convert it appropriately.  The numeric values are also supported as well as actual Enum values.  In fact, here is some code that would result in a successful load of 1 entity from the list of automobiles I defined:</p>

<div id="codeSnippetWrapper">
  <pre style="border-bottom-style: none; text-align: left; padding-bottom: 0px; line-height: 12pt; border-right-style: none; background-color: #f4f4f4; margin: 0em; padding-left: 0px; width: 100%; padding-right: 0px; font-family: 'Courier New', courier, monospace; direction: ltr; border-top-style: none; color: black; font-size: 8pt; border-left-style: none; overflow: visible; padding-top: 0px" id="codeSnippet">var filters = <span style="color: #0000ff">this</span>.automobilesDataSource.FilterDescriptors;<br /> <br /><span style="color: #008000">// We can filter against actual enum values</span><br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsEqualTo, AutoType.Sedan));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThan, AutoType.Coupe));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThanOrEqualTo, AutoType.Coupe));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThan, AutoType.Van));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThanOrEqualTo, AutoType.Van));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsNotEqualTo, AutoType.Van));<br /> <br /><span style="color: #008000">// Or we can filter against string representations of the enum values</span><br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsEqualTo, <span style="color: #006080">"Sedan"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThan, <span style="color: #006080">"Coupe"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThanOrEqualTo, <span style="color: #006080">"Coupe"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThan, <span style="color: #006080">"Van"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThanOrEqualTo, <span style="color: #006080">"Van"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsNotEqualTo, <span style="color: #006080">"Van"</span>));<br /> <br /><span style="color: #008000">// Or we can filter against numeric values</span><br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsEqualTo, 1));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThan, 0));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThanOrEqualTo, 0));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThan, 5));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThanOrEqualTo, 5));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsNotEqualTo, 5));<br /> <br /><span style="color: #008000">// Or we can filter against numeric values represented as strings</span><br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsEqualTo, <span style="color: #006080">"1"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThan, <span style="color: #006080">"0"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsGreaterThanOrEqualTo, <span style="color: #006080">"0"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThan, <span style="color: #006080">"5"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsLessThanOrEqualTo, <span style="color: #006080">"5"</span>));<br />filters.Add(<span style="color: #0000ff">new</span> FilterDescriptor(<span style="color: #006080">"Type"</span>, FilterOperator.IsNotEqualTo, <span style="color: #006080">"5"</span>));<br /> <br /><span style="color: #008000">// But if we try to provide an enum type from the wrong enum, the load will FAIL</span><br /><span style="color: #008000">// filters.Add(new FilterDescriptor("Type", FilterOperator.IsEqualTo, SomeOtherEnum.Van));</span><br /></pre>

  <br /></div>

<p>With the final line that is commented out, if we tried to execute a load with that line in place, we’d get a load error with the following message:</p>

<p><code> </p>

  <p>The FilterDescriptor with its PropertyPath equal to ‘Type’ cannot be evaluated.</p>

  <p> </code></p>

<p>You’ll notice from the above code that the following value types are supported:</p>

<ol>
  <li>Enum values of the same Enum type </li>

  <li>Strings representing the Enum value names </li>

  <li>Integer values representing the Enum values </li>

  <li>Strings representing the Enum integer values </li>
</ol>

<p>Against any of these, we support any operator that works against numeric values:</p>

<ol>
  <li>IsEqualTo </li>

  <li>IsGreaterThan </li>

  <li>IsGreaterThanOrEqualTo </li>

  <li>IsLessThan </li>

  <li>IsLessThanOrEqualTo </li>

  <li>IsNotEqualTo </li>
</ol>

<p>Additionally, we support Nullable Enums.  With Nullable Enums, we only support IsEqualTo and IsNotEqualTo if you specify a Null value.  If you attempt to use IsGreaterThan null, it won’t cause a load error, but it would never evaluate to true, so no entities would ever come back.</p>

<p>I hope this helps, and I hope that the person who asked comes back to see the answer to the question.</p>

<div style="padding-bottom: 0px; margin: 0px; padding-left: 0px; padding-right: 0px; display: inline; float: none; padding-top: 0px" id="scid:0767317B-992E-4b12-91E0-4F059A8CECA8:7e6d92d6-6c3e-470a-b4c7-504e87cb6ebf" class="wlWriterEditableSmartContent">Technorati Tags: <a href="http://technorati.com/tags/RIAServices" rel="tag">RIAServices</a>,<a href="http://technorati.com/tags/DomainDataSource" rel="tag">DomainDataSource</a></div>

