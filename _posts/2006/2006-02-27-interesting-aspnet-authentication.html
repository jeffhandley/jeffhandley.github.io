---
layout: post
title: Interesting ASP.NET Authentication Problem
date: '2006-02-27T08:39:00.000-08:00'
author: Jeff Handley
tags: 
modified_time: '2006-02-27T09:03:21.270-08:00'
blogger_id: tag:blogger.com,1999:blog-10056400.post-114105928346722119
blogger_orig_url: http://jeffhandley.blogspot.com/2006/02/interesting-aspnet-authentication.html
---

I haven't blogged about it, but I'm using AJAX.NET Professional for an AJAX screen in the application I'm working on... I love the library and I'm impressed with what Michael Schwartz has put together.<br /><br />Here are a few links:<br /><ul><br /><li><a href="http://weblogs.asp.net/mschwarz/" target="ajax">Michael's blog</a></li><br /><li><a href="http://ajaxpro.schwarz-interactive.de/" target="ajax">Main site for AJAX.NET Professional</a></li><br /><li><a href="http://www.schwarz-interactive.de/" target="ajax">Michael's main site, currently showing demos for AJAX.NET Professional</a></li><br /><li><a href="http://groups.google.com/group/ajaxpro" target="ajax">Google Group</a></li><br /></ul>Okay, I guess one criticism I'd have for Michael is that it would be nice if there was a 1-stop shop website for his AJAX.NET Professional stuff... it is kind of frustrating that I need to have so many links for him.<br /><br />But anyway... I posted some stuff on his Google group last week when I ran into an interesting problem.  I'm the only one to respond thus far, but I found the solution on my own -- so no big deal.  Here's what I posted (<a href="http://groups.google.com/group/ajaxpro/browse_thread/thread/78fe833da0966c55" target="ajax">View the Google group thread</a>):<br /><br /><hr style="display:block;" />From:  Jeff Handley<br />Date:  Fri, Feb 24 2006 1:23 pm <br /><hr style="display:block;" /><br />I have built a web form that uses several different AjaxMethod calls.  Some calls accept no parameters.  Some calls accept a series of scalar values parameters.  Other calls accept custom classes/types as parameters. <br /><br />Running locally, everything works just fine for all of these different calls.  However, we have deployed out to our testing environment, and only one type of call succeeds -- the ones that accept no parameters. <br /><br />Any AjaxMethod calls that I make that accept parameters fail with the error, "Parameter count mismatch".  I believe this exception is the result of the Reflection call that is made to invoke my AjaxMethod.<br /><br />Again, calls that accept no parameters work just fine on the test server.  And locally, everything works. <br /><br />Any help would be greatly appreciated. <br /><br /><hr style="display:block;" />From:  Jeff Handley<br />Date:  Fri, Feb 24 2006 5:04 pm  <br /><hr style="display:block;" /><br />Okay, I have narrowed this down some.  I downloaded the AjaxPro source code and I've put some code in to spit out information when the parameter count mismatch exception occurs... <br /><br />This is a POST and for some reason the InputStream is empty, and therefore the parameter values cannot be read in. <br /><br />I will keep digging... <br /><br /><hr style="display:block;" />From:  Jeff Handley<br />Date:  Sat, Feb 25 2006 12:41 am  <br /><hr style="display:block;" /><br />Okay, I found the root problem and the solution. <br /><br />Here's some backgroun to what generated the problem: <br /><br />My application requires NT Authentication.  But I was experiencing problems with Firefox when the XmlHttpRequests were made through Ajax.NET Pro, and Firefox was repeatedly prompting for password when Ajax calls were made. <br /><br />So, I created an empty AjaxPro folder at the root of the application, where the Ajax.NET Pro calls will be made through.  In IIS, I had updated that folder, allowing for Anonymous access.  On my local workstation I left Windows Integrated security turned on too.  But when the deployment guy on my project team set up this folder, he disabled Windows Integrated, leaving only Anonymous on. <br /><br />The following blog entry (which has a link to MS KB) explains what happens when you have mixed security mode: <br /><br /><a href="http://blogs.msdn.com/david.wang/archive/2005/12/01/HTTP_POST_Fails_for_Anonymous_Authentication.aspx" target="ajax">David Wang's Blog Entry</a><br /><br />I ended up finding that XmlHttpRequest posts into the AjaxPro folder had Content-Length of 0, even though the core.js was setting this header.  But if I hacked core.js to send the request into another folder in the application, Content-Length was set correctly. <br /><br />In the end, I need to turn Windows Integrated on for the AjaxPro folder, but also leave Anonymous on to get around the Firefox issue. <br /><br />What a fun day this was!