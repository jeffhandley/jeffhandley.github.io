---
layout: post
title: ShouldUseDataSet()
date: '2005-04-29T14:59:00.000-07:00'
author: Jeff Handley
tags: 
modified_time: '2005-05-03T13:08:48.326-07:00'
blogger_id: tag:blogger.com,1999:blog-10056400.post-111481450853167152
blogger_orig_url: http://jeffhandley.blogspot.com/2005/04/shouldusedataset.html
---

In response to <a href="http://scottonwriting.net/sowblog/posts/3615.aspx" target="Scott">Scott's Mitchell's posting "Why I Don't Use DataSets in My ASP.NET Applications"</a>, I decided to document my decision process for determining whether or not to use a DataSet or a DataTable as opposed to a DataReader.<br /><br />I decided to document this process in a code format, just because that was fun :-)<br /><hr /><span style="font-family:courier new;"><br />Private _SortingThreshold As Integer = 50<br />Private _CachingThreshold As Integer = 50<br />Private _NumberDevelopersOnProject As Integer = 1<br /><br />Public NumberSortableDataScreens As Integer<br />Public NumberCacheableResultsets As Integer<br /><br />Public Property NumberDevelopersOnProject As Integer<br />&nbsp;&nbsp;&nbsp;&nbsp;Get<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return _NumberDevelopersOnProject<br />&nbsp;&nbsp;&nbsp;&nbsp;End Get<br />&nbsp;&nbsp;&nbsp;&nbsp;Set(Value As Integer)<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_NumberDevelopersOnProject = Value<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'The Number of developers on the project helps<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'drive the level of sorting and caching that<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'can be done the old-fashioned way. These<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'numbers aren't solid, but the help<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'demonstrate the decision process.<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If _NumberDevelopersOnProject = 1 Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_SortingThreshold = 50<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_CachingThreshold = 50<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ElseIf _NumberDevelopersOnProject <= 5 Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_SortingThreshold = 25<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_CachingThreshold = 50<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Else 'More than 5 developers on the project<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_SortingThreshold = 25<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_CachingThreshold = 25<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If<br />&nbsp;&nbsp;&nbsp;&nbsp;End Set<br />End Property<br /><br />Function ShouldUseDataSet(ControlToBind As Control, _<br />&nbsp;&nbsp;&nbsp;&nbsp;HasNestedDataBinding As Boolean,<br />&nbsp;&nbsp;&nbsp;&nbsp;IsCacheable As Boolean) As Boolean<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;If ControlToBind Is DataGrid Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'If the datagrid allows sorting, we'll use a<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'DataView to apply the sort dynamically.<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'However, we'll retrieve the data from the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'database each time, and apply sorting in<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'the BLL before the DataView is returned to<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'the Web.UI<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'I know that this type of dynamic sorting can<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'be off-loaded to the stored procedure,<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'but you really have to jump through some hoops<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'to do that. With a large number of stored<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'procedures that can be GREATLY simplified by<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'off-loading the sorting to the .NET code... so<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'this parameter is really determined by the<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'size of the Application<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;If NumberSortableDataScreens > _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;_SortingThreshold AndAlso _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DirectCast(ControToBind, _<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataGrid).AllowSorting Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return True<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;End If<br />&nbsp;&nbsp;&nbsp;&nbsp;End If<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;'If the page is rendering some nested databound<br />&nbsp;&nbsp;&nbsp;&nbsp;'controls, then the DataSet is a no-brainer.<br />&nbsp;&nbsp;&nbsp;&nbsp;'For example, I once had to create a display that<br />&nbsp;&nbsp;&nbsp;&nbsp;'had many levels of nested data. The result of<br />&nbsp;&nbsp;&nbsp;&nbsp;'the ASPX code was something like this:<br />&nbsp;&nbsp;&nbsp;&nbsp;'<br />&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;&nbsp;&nbsp;&nbsp;DataList<br />&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Repeater<br />&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataGrid<br />&nbsp;&nbsp;&nbsp;&nbsp;'&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DataGrid<br />&nbsp;&nbsp;&nbsp;&nbsp;'<br />&nbsp;&nbsp;&nbsp;&nbsp;'Having 2 DataGrids inside a Repeater inside<br />&nbsp;&nbsp;&nbsp;&nbsp;'a DataList... the screen was working in less<br />&nbsp;&nbsp;&nbsp;&nbsp;'than 4 hours, and looked pretty snazzy. I used<br />&nbsp;&nbsp;&nbsp;&nbsp;'the RowFilter property of the DataView to pull<br />&nbsp;&nbsp;&nbsp;&nbsp;'off the Nested DataBinding, and that has been<br />&nbsp;&nbsp;&nbsp;&nbsp;'my typical approach with nested databinding<br />&nbsp;&nbsp;&nbsp;&nbsp;'ever since<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;If HasNestedDataBinding Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return True<br />&nbsp;&nbsp;&nbsp;&nbsp;End If<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;'The current project I'm working on is a very<br />&nbsp;&nbsp;&nbsp;&nbsp;'large ASP.NET application, with over 600 ASPX<br />&nbsp;&nbsp;&nbsp;&nbsp;'screens for data maintenance.  There are hundreds<br />&nbsp;&nbsp;&nbsp;&nbsp;'of "lookup tables" in the application, except<br />&nbsp;&nbsp;&nbsp;&nbsp;'this data can be configured by each client of the<br />&nbsp;&nbsp;&nbsp;&nbsp;'system. So a lookup table may contain 100,000<br />&nbsp;&nbsp;&nbsp;&nbsp;'records,however only 10 apply to each client.<br />&nbsp;&nbsp;&nbsp;&nbsp;'For many of the dropdowns in the application that<br />&nbsp;&nbsp;&nbsp;&nbsp;'are driven from these "lookup tables", the middle<br />&nbsp;&nbsp;&nbsp;&nbsp;'layer of the application will cache the data for<br />&nbsp;&nbsp;&nbsp;&nbsp;'each client. The client's ID (guid) is used as<br />&nbsp;&nbsp;&nbsp;&nbsp;'part of the cache key to ensure that each client<br />&nbsp;&nbsp;&nbsp;&nbsp;'has their own copy of the cached data.<br />&nbsp;&nbsp;&nbsp;&nbsp;'<br />&nbsp;&nbsp;&nbsp;&nbsp;'DataTables are used to cache this data because of<br />&nbsp;&nbsp;&nbsp;&nbsp;'their simplicity mainly. We could create the<br />&nbsp;&nbsp;&nbsp;&nbsp;'hundreds of custom objects, or find a design for<br />&nbsp;&nbsp;&nbsp;&nbsp;'a generic object, and cache the data using those;<br />&nbsp;&nbsp;&nbsp;&nbsp;'but that just really seems like reinventing the<br />&nbsp;&nbsp;&nbsp;&nbsp;'wheel to me since the DataTable can support<br />&nbsp;&nbsp;&nbsp;&nbsp;'all of these structures out of the box<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;If NumberCacheableResultsets > _CachingThreshold _<br />&nbsp;&nbsp;&nbsp;&nbsp;AndAlso IsCacheable Then<br />&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Return True<br />&nbsp;&nbsp;&nbsp;&nbsp;End If<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;'If the data isn't sortable by the user, there<br />&nbsp;&nbsp;&nbsp;&nbsp;'isn't nested databinding, and the data can't<br />&nbsp;&nbsp;&nbsp;&nbsp;'be cached then we default back to a DataReader<br /><br />&nbsp;&nbsp;&nbsp;&nbsp;Return False<br /><br />End Function<br /></span>